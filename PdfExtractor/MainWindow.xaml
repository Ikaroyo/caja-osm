<Window x:Class="PdfExtractor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wf="clr-namespace:System.Windows.Forms;assembly=System.Windows.Forms"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="PDF Extractor - Control de Caja OSM" Height="900" Width="1400" WindowState="Maximized">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="650" MinWidth="400"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="*" MinWidth="300"/>
        </Grid.ColumnDefinitions>
        
        <!-- Left Panel: Web Browser -->
        <Border Grid.Column="0" BorderBrush="Gray" BorderThickness="1" Margin="5">
            <Grid>
                <!-- WebBrowser clásico para Java applets -->
                <WindowsFormsHost Margin="5" Height="850">
                    <wf:WebBrowser x:Name="WebBrowser" 
                                   ScriptErrorsSuppressed="False"
                                   WebBrowserShortcutsEnabled="True"
                                   IsWebBrowserContextMenuEnabled="True"
                                   AllowWebBrowserDrop="True"
                                   DocumentCompleted="WebBrowser_DocumentCompleted"
                                   Navigating="WebBrowser_Navigating"/>
                </WindowsFormsHost>
            </Grid>
        </Border>

        <!-- Resizable Splitter -->
        <GridSplitter Grid.Column="1" 
                      HorizontalAlignment="Stretch" 
                      VerticalAlignment="Stretch"
                      Background="LightGray"
                      ShowsPreview="True"
                      ResizeBehavior="PreviousAndNext"
                      Width="5"/>

        <!-- Right Panel: Tabs -->
        <Border Grid.Column="2" BorderBrush="DarkGray" BorderThickness="2" Margin="10">
            <TabControl x:Name="mainTabControl" Background="WhiteSmoke">
                
                <!-- PDF Extractor Tab -->
                <TabItem Header="📄 Extractor PDF" FontWeight="Bold">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="200"/>
                        </Grid.RowDefinitions>
                        
                        <!-- PDF Input Section -->
                        <GroupBox Grid.Row="0" Header="Entrada de PDF" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <TextBlock Text="Ingrese el link completo o solo el número:" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBox x:Name="txtInput" Height="25" Margin="0,0,0,10"/>
                                
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                                    <Button x:Name="btnProcess" Content="📥 Procesar PDF" Width="120" Height="30" 
                                           Click="BtnProcess_Click" Margin="0,0,10,0" Background="LightBlue"/>
                                    <Button x:Name="btnExtractData" Content="⚙️ Extraer Datos" Width="120" Height="30" 
                                           Click="BtnExtractData_Click" Margin="0,0,10,0" IsEnabled="False" Background="LightGreen" Visibility="Collapsed"/>
                                    <Button x:Name="btnClear" Content="🗑️ Limpiar" Width="80" Height="30" 
                                           Click="BtnClear_Click" Background="LightCoral"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- Management Buttons -->
                        <GroupBox Grid.Row="1" Header="Gestión" Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal" Margin="10" HorizontalAlignment="Left">
                                <Button x:Name="btnViewLotes" Content="📋 Ver Lotes" Width="100" Height="30" 
                                       Click="BtnViewLotes_Click" Margin="0,0,10,0" Background="LightYellow"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- Status -->
                        <TextBlock Grid.Row="2" x:Name="txtStatus" Text="Listo" Margin="0,0,0,10" 
                                  Foreground="Blue" FontWeight="Bold" Background="AliceBlue" Padding="5"/>
                        
                        <!-- Extracted Data Display - Oculto por solicitud del usuario -->
                                                <!-- Extracted Data Display - Oculto por solicitud del usuario -->
                        <GroupBox Grid.Row="3" Header="Datos Extraídos" Margin="0,0,0,10" MaxHeight="200" Visibility="Collapsed">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel x:Name="extractedDataPanel" Margin="5">
                                    <TextBlock Text="Los datos extraídos aparecerán aquí..." 
                                              Foreground="Gray" FontStyle="Italic"/>
                                </StackPanel>
                            </ScrollViewer>
                        </GroupBox>
                        
                        <!-- PDF Content Display - Oculto por solicitud del usuario -->
                        <GroupBox Grid.Row="4" Header="Contenido del PDF" Margin="0,0,0,10" Visibility="Collapsed">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <TextBox x:Name="txtContent" IsReadOnly="True" TextWrapping="Wrap" 
                                        AcceptsReturn="True" VerticalAlignment="Stretch" 
                                        Background="LightYellow" BorderThickness="0"/>
                            </ScrollViewer>
                        </GroupBox>
                        
                        <!-- Quick Actions -->
                        <GroupBox Grid.Row="5" Header="Acciones Rápidas">
                            <Grid Margin="5">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                    <Button Content="💾 Guardar como..." Width="100" Height="25" Margin="0,0,5,0" Visibility="Collapsed"/>
                                    <Button Content="📧 Enviar por email" Width="120" Height="25" Margin="0,0,5,0" Visibility="Collapsed"/>
                                    <Button Content="🖨️ Imprimir" Width="80" Height="25" Click="BtnPrint_Click"/>
                                </StackPanel>
                                
                                <TextBox Grid.Row="1" x:Name="txtQuickNotes" 
                                        TextWrapping="Wrap" AcceptsReturn="True"
                                        Background="LightGray" 
                                        Text="Notas rápidas..."/>
                            </Grid>
                        </GroupBox>
                    </Grid>
                </TabItem>
                
                <!-- Calculator Tab -->
                <TabItem Header="🧮 Calculadora" FontWeight="Bold">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="50"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Calculator Title -->
                        <TextBlock Grid.Row="0" Text="Calculadora Financiera" FontWeight="Bold" FontSize="16" 
                                  Margin="0,0,0,20" HorizontalAlignment="Center" Foreground="DarkBlue"/>
                        
                        <!-- Display -->
                        <TextBox Grid.Row="1" x:Name="txtCalculatorDisplay" FontSize="20" FontWeight="Bold" 
                                Text="0" TextAlignment="Right" IsReadOnly="True" Background="Black" 
                                Foreground="Lime" Margin="0,0,0,10" Padding="10"/>
                        
                        <!-- Calculator Buttons -->
                        <Grid Grid.Row="2" Margin="0,0,0,20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Row 0 -->
                            <Button Grid.Row="0" Grid.Column="0" Content="C" Click="Calculator_Click" 
                                   Margin="2" Background="OrangeRed" Foreground="White" FontWeight="Bold"/>
                            <Button Grid.Row="0" Grid.Column="1" Content="CE" Click="Calculator_Click" 
                                   Margin="2" Background="Orange" Foreground="White" FontWeight="Bold"/>
                            <Button Grid.Row="0" Grid.Column="2" Content="←" Click="Calculator_Click" 
                                   Margin="2" Background="Orange" Foreground="White" FontWeight="Bold"/>
                            <Button Grid.Row="0" Grid.Column="3" Content="÷" Click="Calculator_Click" 
                                   Margin="2" Background="SteelBlue" Foreground="White" FontWeight="Bold"/>
                            
                            <!-- Row 1 -->
                            <Button Grid.Row="1" Grid.Column="0" Content="7" Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="1" Grid.Column="1" Content="8" Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="1" Grid.Column="2" Content="9" Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="1" Grid.Column="3" Content="×" Click="Calculator_Click" 
                                   Margin="2" Background="SteelBlue" Foreground="White" FontWeight="Bold"/>
                            
                            <!-- Row 2 -->
                            <Button Grid.Row="2" Grid.Column="0" Content="4" Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="2" Grid.Column="1" Content="5" Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="2" Grid.Column="2" Content="6" Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="2" Grid.Column="3" Content="-" Click="Calculator_Click" 
                                   Margin="2" Background="SteelBlue" Foreground="White" FontWeight="Bold"/>
                            
                            <!-- Row 3 -->
                            <Button Grid.Row="3" Grid.Column="0" Content="1" Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="3" Grid.Column="1" Content="2" Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="3" Grid.Column="2" Content="3" Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="3" Grid.Column="3" Content="+" Click="Calculator_Click" 
                                   Margin="2" Background="SteelBlue" Foreground="White" FontWeight="Bold"/>
                            
                            <!-- Row 4 -->
                            <Button Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2" Content="0" 
                                   Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="4" Grid.Column="2" Content="," Click="Calculator_Click" Margin="2"/>
                            <Button Grid.Row="4" Grid.Column="3" Content="=" Click="Calculator_Click" 
                                   Margin="2" Background="Green" Foreground="White" FontWeight="Bold"/>
                        </Grid>
                        
                        <!-- Calculator Memory/History -->
                        <GroupBox Grid.Row="3" Header="Historial" MaxHeight="150">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <TextBox x:Name="txtCalculatorHistory" IsReadOnly="True" 
                                        Background="WhiteSmoke" BorderThickness="0" 
                                        TextWrapping="Wrap" AcceptsReturn="True"
                                        Text="Historial de cálculos aparecerá aquí..."/>
                            </ScrollViewer>
                        </GroupBox>
                    </Grid>
                </TabItem>
                
                <!-- Additional Tools Tab -->
                <TabItem Header="⚙️ Configuraciones" FontWeight="Bold">
                    <Grid Margin="10">
                        <StackPanel>
                            <GroupBox Header="Configuración de Guardado" Margin="0,0,0,20">
                                <StackPanel Margin="10">
                                    <Button x:Name="btnConfig" Content="💾 Configurar Ubicación de Lotes" Height="35" Margin="0,0,0,10" 
                                           Click="BtnConfig_Click" HorizontalAlignment="Stretch" Background="LightBlue"/>
                                    <TextBlock Text="Configura dónde se guardan los datos de los lotes procesados" 
                                              FontStyle="Italic" Foreground="Gray" Margin="0,0,0,10"/>
                                </StackPanel>
                            </GroupBox>
                            
                            <GroupBox Header="Herramientas de Sistema" Margin="0,0,0,20">
                                <StackPanel Margin="10">
                                    <Button Content="🔍 Verificar Java" Height="35" Margin="0,0,0,10" 
                                           Click="BtnCheckJava_Click" HorizontalAlignment="Stretch"/>
                                    <Button Content="📁 Abrir Carpeta de Datos" Height="35" Margin="0,0,0,10" 
                                           Click="BtnOpenDataFolder_Click" HorizontalAlignment="Stretch"/>
                                    <Button Content="🔄 Reiniciar Aplicación" Height="35" 
                                           Click="BtnRestartApp_Click" HorizontalAlignment="Stretch"/>
                                </StackPanel>
                            </GroupBox>
                            
                            <GroupBox Header="Información del Sistema">
                                <TextBox x:Name="txtSystemInfo" IsReadOnly="True" Height="200" 
                                        TextWrapping="Wrap" AcceptsReturn="True" 
                                        VerticalScrollBarVisibility="Auto" Background="LightGray"/>
                            </GroupBox>
                        </StackPanel>
                    </Grid>
                </TabItem>
                
                <!-- Debug Tab -->
                <TabItem Header="🐛 Debug" FontWeight="Bold" Background="Orange" Visibility="Collapsed">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <GroupBox Grid.Row="0" Header="Controles de Debug" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <Button x:Name="btnClearDebug" Content="🗑️ Limpiar" Width="80" Height="30" 
                                           Click="BtnClearDebug_Click" Margin="0,0,10,0" Background="Red" Foreground="White"/>
                                    <Button x:Name="btnTestNav" Content="🔄 Test Nav" Width="80" Height="30" 
                                           Click="BtnTestNav_Click" Margin="0,0,10,0" Background="Blue" Foreground="White"/>
                                    <Button x:Name="btnCheckBrowser" Content="🔍 Check" Width="80" Height="30" 
                                           Click="BtnCheckBrowser_Click" Margin="0,0,10,0" Background="Green" Foreground="White"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="btnForceJava" Content="☕ Force Java" Width="80" Height="30" 
                                           Click="BtnForceJava_Click" Margin="0,0,5,0" Background="Orange" Foreground="White"/>
                                    <Button x:Name="btnCheckJavaStatus" Content="✅ Status" Width="60" Height="30" 
                                           Click="BtnCheckJavaStatus_Click" Margin="0,0,5,0" Background="Purple" Foreground="White"/>
                                    <Button x:Name="btnFixPermissions" Content="🔧 Fix Perms" Width="80" Height="30" 
                                           Click="BtnFixPermissions_Click" Margin="0,0,5,0" Background="Red" Foreground="White"/>
                                    <Button x:Name="btnLaunchJNLP" Content="🚀 JNLP" Width="60" Height="30" 
                                           Click="BtnLaunchJNLP_Click" Margin="0,0,5,0" Background="DarkBlue" Foreground="White"/>
                                    <Button x:Name="btnSigemiAuto" Content="🎯 SIGEMI" Width="70" Height="30" 
                                           Click="BtnSigemiAuto_Click" Background="MediumSeaGreen" Foreground="White" FontWeight="Bold"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Grid.Row="1" Header="Log de Debug en Tiempo Real">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <Border Grid.Row="0" Background="LightYellow" Padding="10" Margin="0,0,0,5">
                                    <TextBlock TextWrapping="Wrap" FontSize="11">
                                        <Run FontWeight="Bold" Foreground="DarkRed">🎯 PROBLEMA IDENTIFICADO:</Run>
                                        <LineBreak/>
                                        <Run>Oracle Forms requiere Java 1.4.2 (2003) pero tienes Java 1.8. El WebBrowser .NET no puede ejecutar applets Java por incompatibilidad de versiones.</Run>
                                        <LineBreak/>
                                        <Run FontWeight="Bold" Foreground="DarkBlue">✅ SOLUCIÓN RECOMENDADA:</Run>
                                        <Run>Usar </Run><Run FontWeight="Bold">"🚀 JNLP"</Run><Run> o navegador externo que puede manejar versiones Java múltiples.</Run>
                                    </TextBlock>
                                </Border>
                                
                                <ScrollViewer Grid.Row="1" x:Name="DebugScrollViewer" VerticalScrollBarVisibility="Auto">
                                    <TextBox x:Name="txtDebugLog" IsReadOnly="True" 
                                            Background="Black" Foreground="Lime" 
                                            FontFamily="Consolas" FontSize="11"
                                            TextWrapping="Wrap" AcceptsReturn="True"
                                            Text="=== LOG DE DEBUG ===&#x0A;Esperando eventos...&#x0A;"/>
                                </ScrollViewer>
                            </Grid>
                        </GroupBox>
                    </Grid>
                </TabItem>
            </TabControl>
        </Border>
    </Grid>
</Window>
